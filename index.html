<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연구소 DB Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; word-break: keep-all; }
        .hidden { display: none; }
        .role-label.selected { background-color: #f59e0b; color: #1e293b; border-color: #d97706; }
        .modal-body::-webkit-scrollbar { width: 8px; height: 8px; }
        .modal-body::-webkit-scrollbar-track { background: #f1f5f9; }
        .modal-body::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        input:disabled, select:disabled, textarea:disabled { background-color: #f1f5f9; cursor: not-allowed; opacity: 0.7; }
        input[readonly] { background-color: #f1f5f9; }
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8); z-index: 1000;
            display: flex; align-items: center; justify-content: center;
        }
        .loader {
            border: 8px solid #f3f3f3; border-top: 8px solid #3498db;
            border-radius: 50%; width: 60px; height: 60px; animation: spin 2s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .tooltip-icon {
            position: relative; margin-left: 6px; cursor: pointer; color: #94a3b8;
            border: 1px solid #e2e8f0; border-radius: 50%; width: 20px; height: 20px;
            display: inline-flex; justify-content: center; align-items: center;
            font-size: 12px; font-weight: bold; font-style: italic; user-select: none; transition: all 0.2s ease;
        }
        .tooltip-icon:hover { background-color: #1e293b; color: white; border-color: #1e293b; }
        #global-tooltip {
            visibility: hidden; width: 280px; background-color: #1e293b; color: #fff;
            text-align: left; border-radius: 6px; padding: 12px; position: fixed;
            z-index: 1001; opacity: 0; transition: opacity 0.2s; pointer-events: none;
            font-size: 13px; font-weight: 400; line-height: 1.6;
        }
        th, td, button, a { white-space: nowrap; }
        /* 전체 화면 사용 */
        .full-width-container { width: 100%; padding: 8px; }
        @media (min-width: 768px) { .full-width-container { padding: 16px; } }
    </style>
</head>
<body class="bg-slate-100 pb-20">

    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loader"></div>
    </div>
    
    <div id="global-tooltip"></div>

    <!-- 비밀번호 강제 변경 모달 -->
    <div id="force-password-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[1000]">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
            <div class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-4">
                <h3 class="text-xl font-bold text-center">🔐 비밀번호 변경 필요</h3>
            </div>
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="text-5xl mb-3">⚠️</div>
                    <p class="text-lg font-semibold text-slate-800 mb-2">최초 로그인 시 비밀번호를 변경해야 합니다.</p>
                    <p class="text-sm text-slate-500">보안을 위해 새로운 비밀번호를 설정해주세요.</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">새 비밀번호 <span class="text-red-500">*</span></label>
                        <input type="password" id="force-new-password" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="새 비밀번호 입력">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">새 비밀번호 확인 <span class="text-red-500">*</span></label>
                        <input type="password" id="force-new-password-confirm" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="새 비밀번호 다시 입력">
                    </div>
                    <p class="text-xs text-red-600">※ 비밀번호 변경 후 서비스를 이용하실 수 있습니다.</p>
                </div>
            </div>
            <div class="px-6 pb-6">
                <button onclick="saveForcePasswordChange()" class="w-full py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold rounded-lg transition-all">비밀번호 변경하기</button>
            </div>
        </div>
    </div>

    <!-- 로그인 페이지 -->
    <div id="login-page">
        <div class="flex items-center justify-center min-h-screen">
            <div class="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-xl">
                <header class="text-center">
                    <h1 class="text-3xl font-bold text-slate-800">연구소 DB Project</h1>
                    <p class="mt-2 text-sm text-slate-500">제작 : (주)한국FP센터 부설 중소기업경영연구소</p>
                </header>
                <form id="login-form" class="mt-8 space-y-6">
                    <div>
                        <label for="username" class="text-sm font-semibold text-slate-700">아이디 (성명)</label>
                        <input id="username" type="text" required class="mt-2 block w-full px-4 py-3 bg-slate-50 border rounded-lg" placeholder="가입하신 성명을 입력하세요">
                    </div>
                    <div>
                        <label for="password" class="text-sm font-semibold text-slate-700">전화번호 (비밀번호)</label>
                        <input id="password" type="password" required class="mt-2 block w-full px-4 py-3 bg-slate-50 border rounded-lg" placeholder="'-'를 제외한 전화번호를 입력하세요">
                    </div>
                    <div><button type="submit" class="w-full flex justify-center py-3 px-4 text-base font-bold rounded-lg text-white bg-slate-800 hover:bg-slate-900">로그인</button></div>
                </form>
                <div class="pt-4 border-t grid grid-cols-3 gap-3">
                    <button type="button" onclick="showProcessModal()" class="text-center py-3 px-2 text-sm font-semibold rounded-lg text-white bg-violet-600 hover:bg-violet-700">업무Process</button>
                    <button type="button" onclick="showFeaturesModal()" class="text-center py-3 px-2 text-sm font-semibold rounded-lg text-white bg-sky-600 hover:bg-sky-700">주요기능</button>
                    <button type="button" onclick="showPriceTableModal()" class="text-center py-3 px-2 text-sm font-semibold rounded-lg text-white bg-teal-600 hover:bg-teal-700">가격표</button>
                </div>
                <div class="pt-1 grid grid-cols-2 gap-3">
                    <button type="button" onclick="showFaxModal()" class="text-center py-3 px-2 text-sm font-semibold rounded-lg text-white bg-amber-600 hover:bg-amber-700">Fax안내문</button>
                    <button type="button" onclick="showCallHelpModal()" class="text-center py-3 px-2 text-sm font-semibold rounded-lg text-white bg-rose-600 hover:bg-rose-700">Call도움메세지</button>
                </div>
                
                <!-- 주요기능 모달 -->
                <div id="features-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
                        <!-- 헤더 -->
                        <div class="bg-gradient-to-r from-sky-600 via-blue-600 to-indigo-700 text-white px-6 py-5">
                            <h3 class="text-2xl font-bold text-center tracking-tight">기업홈페이지 시스템</h3>
                            <p class="text-center text-sky-100 text-sm mt-1">주요기능 안내</p>
                        </div>
                        
                        <!-- 컨텐츠 -->
                        <div class="p-6 overflow-y-auto max-h-[60vh] space-y-4">
                            <!-- 기능 1 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">1</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">기업 맞춤형 홈페이지</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 대외신뢰 및 마케팅 홍보용으로 적절</p>
                                        <p class="text-sm text-slate-600">• 거래처/고객/입사지원자에게 '정돈된 회사' 인식 어필</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 2 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">2</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">100% 커스터마이징 (브랜드 그대로)</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 로고, 이미지, 푸터, 인사말, 메뉴 구성 등 회사 맞춤 수정</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 3 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">3</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">연구소 보유시</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 연구노트/과제 기록/증빙 자료를 구조화 저장</p>
                                        <p class="text-sm text-slate-600">• 연 1회 실사대응 시 자료 누락방지 및 찾는 시간 감소</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 4 -->
                            <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center font-bold text-sm">4</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">중요문서 시점인증 (타임스탬프) 기록보호</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 문서를 "언제 생성됐고 위변조가 없다"를 증명하는 장치</p>
                                        <p class="text-sm text-slate-600">• 분쟁/소명/인정 과정에서 증빙력이 달라짐 (법적보호, 안전장치)</p>
                                        <p class="text-sm text-slate-500 italic">• 연구노트, 근로계약서, 제휴협약서, 견적서 등</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 5 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">5</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">문서보관/자료실 (사내 인트라넷 기능)</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 회사 규정/양식/계약서/교육자료/회의록/증빙 등을 보관</p>
                                        <p class="text-sm text-slate-600">• 담당자 바뀌어도 운영 안정</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 6 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">6</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">업무일지 (전 직원 공용)</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 일일 업무기록, 업무내용보관, 업무이슈 상시기록보관</p>
                                        <p class="text-sm text-slate-600">• CEO 전사 업무현황 파악 용이</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 7 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">7</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">출퇴근 관리 (전 직원)</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 출퇴근 기록, 근태 데이터 누적</p>
                                        <p class="text-sm text-slate-600">• 시간외수당 및 계약직 급여관리 계산 용이</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 8 -->
                            <div class="bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-4 border border-violet-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-violet-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">8</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">생성형 AI 종량제 이용</h4>
                                        <p class="text-sm text-slate-600 mt-1">• GPT, Gemini 종량제 토큰구입 이용</p>
                                        <p class="text-sm text-slate-600">• UI (베타버전 제공)</p>
                                        <p class="text-sm text-violet-600 font-medium">• 상반기 변화: 정식버전 UI제공, Claude, Perplexity 사용 추가</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 9 -->
                            <div class="bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-4 border border-violet-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-violet-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">9</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">1:1 고객센터 AI 탑재</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 고객문의 → AI 또는 직원 중 선택</p>
                                        <p class="text-sm text-slate-600">• AI문의시 RAG방식 자동답변 시스템 탑재 (문서기반 자동응답)</p>
                                        <p class="text-sm text-slate-600">• 단순, 반복질문에 대하여 AI가 자동답변</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 10 -->
                            <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border border-emerald-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-emerald-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">10</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">법정의무교육 연동 <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full ml-1">회원사 혜택</span></h4>
                                        <p class="text-sm text-slate-600 mt-1">• 전직원 법정의무 교육비 회원가 제공 (시장 평균가의 50% 수준)</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 11 -->
                            <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border border-emerald-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-emerald-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">11</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">종합건강검진 <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full ml-1">회원사 혜택</span></h4>
                                        <p class="text-sm text-slate-600 mt-1">• 대기업 수가 제공</p>
                                        <p class="text-sm text-slate-600">• 대상: 전임직원 및 가족까지</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 12 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">12</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">ESG경영 전용페이지 제공</h4>
                                        <p class="text-sm text-slate-600 mt-1">• ESG 실천사항을 게시·축적하는 전용 코너</p>
                                        <p class="text-sm text-slate-600">• 거래처 혹은 기관이 ESG 요구할 때 "문서가 아닌 홈페이지로 사실증명"</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 13 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">13</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">관리자 페이지 (운영 통제)</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 기업맞춤형 전용 관리자 페이지 제공</p>
                                        <p class="text-sm text-slate-600">• 메뉴명칭 변경, 이미지 변경, 콘텐츠업로드 등 통합 관리</p>
                                        <p class="text-sm text-slate-600">• 외주 의존 없이 내부에서 바로 수정/통제</p>
                                        <p class="text-sm text-sky-600 font-medium">• 신속한 변경, 업데이트 및 유지보수 비용 제로화</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 14 -->
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-sky-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">14</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">전 임직원 개별사용</h4>
                                        <p class="text-sm text-slate-600 mt-1">• 직원별 로그인기능 사용</p>
                                        <p class="text-sm text-slate-600">• 책임자가 전임직원 콘트롤 (직원 계정을 직접 생성해서 제공)</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 기능 15 -->
                            <div class="bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-4 border border-rose-200 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <span class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-rose-500 to-pink-500 text-white rounded-lg flex items-center justify-center font-bold text-sm">15</span>
                                    <div>
                                        <h4 class="font-bold text-slate-800">2026년 추가 프로그램 <span class="text-xs bg-rose-100 text-rose-700 px-2 py-0.5 rounded-full ml-1">Coming Soon</span></h4>
                                        <p class="text-sm text-slate-600 mt-1">• 출퇴근 프로그램 (2월 런칭)</p>
                                        <p class="text-sm text-slate-600">• 인사노무 관리 프로그램</p>
                                        <p class="text-sm text-slate-600">• 생성형 AI UI 업데이트</p>
                                        <p class="text-sm text-slate-600">• AI종량제 추가구축 (Claude, Perplexity)</p>
                                        <p class="text-sm text-slate-600">• 기업별 결제시스템 구축</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 푸터 -->
                        <div class="px-6 py-4 bg-slate-50 border-t">
                            <button type="button" onclick="closeFeaturesModal()" class="w-full py-3 bg-gradient-to-r from-slate-800 to-slate-900 hover:from-slate-900 hover:to-black text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl">닫기</button>
                        </div>
                    </div>
                </div>
                
                <!-- 가격표 모달 -->
                <div id="price-table-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-4 overflow-hidden">
                        <div class="bg-teal-600 text-white px-6 py-4">
                            <h3 class="text-xl font-bold text-center">기업홈페이지 가격표</h3>
                        </div>
                        <div class="p-6">
                            <table class="w-full text-sm">
                                <tbody class="divide-y">
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">제작비</td>
                                        <td class="py-3 text-right text-teal-600 font-bold">무료</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">유지/보수 비용</td>
                                        <td class="py-3 text-right text-teal-600 font-bold">없음</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">초기셋팅비</td>
                                        <td class="py-3 text-right font-bold">100만원</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">서버등록비 (1회)</td>
                                        <td class="py-3 text-right font-bold">10만원</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">월이용료</td>
                                        <td class="py-3 text-right font-bold">10만원</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3 font-semibold text-slate-700">웹호스팅비</td>
                                        <td class="py-3 text-right text-slate-500">이용량에 따라 결정</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 pb-6">
                            <button type="button" onclick="closePriceTableModal()" class="w-full py-3 bg-slate-800 hover:bg-slate-900 text-white font-bold rounded-lg">닫기</button>
                        </div>
                    </div>
                </div>
                
                <!-- 업무Process 모달 -->
                <div id="process-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-xl w-full max-h-[90vh] overflow-hidden">
                        <!-- 헤더 -->
                        <div class="bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-700 text-white px-6 py-5">
                            <h3 class="text-xl font-bold text-center tracking-tight">홈페이지 없는 '연구소 보유기업'</h3>
                            <p class="text-center text-violet-100 text-sm mt-1">Call Process</p>
                        </div>
                        
                        <!-- 컨텐츠 -->
                        <div class="p-5 overflow-y-auto max-h-[60vh]">
                            <!-- 타임라인 -->
                            <div class="relative">
                                <!-- 연결선 -->
                                <div class="absolute left-5 top-0 bottom-0 w-0.5 bg-gradient-to-b from-violet-400 via-purple-400 to-indigo-400"></div>
                                
                                <!-- Step 1 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">1</div>
                                    <div class="flex-1 bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-3 border border-violet-100">
                                        <p class="text-sm text-slate-700">로그인 후 <span class="font-semibold text-violet-700">Call가능 일정 선택</span> → 본사에서 피드백</p>
                                    </div>
                                </div>
                                
                                <!-- Step 2 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">2</div>
                                    <div class="flex-1 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-3 border border-slate-200">
                                        <p class="text-sm text-slate-700">확정된 일자 <span class="font-semibold text-violet-700">오전 11시</span>에 안내문을 Fax로 전송 (본사)</p>
                                    </div>
                                </div>
                                
                                <!-- Step 3 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">3</div>
                                    <div class="flex-1 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-3 border border-slate-200">
                                        <p class="text-sm text-slate-700">안내문 하단에 <span class="font-semibold text-violet-700">'전문위원' 성명과 연락처</span>를 기재하여 발송</p>
                                    </div>
                                </div>
                                
                                <!-- Step 4 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">4</div>
                                    <div class="flex-1 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-3 border border-slate-200">
                                        <p class="text-sm text-slate-700">Fax전송 <span class="font-semibold text-violet-700">'성공List'</span> 추출하여 기업정보를 Program에 업로드</p>
                                    </div>
                                </div>
                                
                                <!-- Step 5 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">5</div>
                                    <div class="flex-1 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-3 border border-amber-200">
                                        <p class="text-sm text-slate-700"><span class="font-semibold text-amber-700">오후 2시</span>부터 전문위원 Call 진행</p>
                                    </div>
                                </div>
                                
                                <!-- Step 6 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">6</div>
                                    <div class="flex-1 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-3 border border-amber-200">
                                        <p class="text-sm text-slate-700">Call 진행상황 <span class="font-semibold text-amber-700">P/G에 입력</span></p>
                                    </div>
                                </div>
                                
                                <!-- Step 7 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">7</div>
                                    <div class="flex-1 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-3 border border-emerald-200">
                                        <p class="text-sm text-slate-700">기업홈페이지 <span class="font-semibold text-emerald-700">관심기업</span> 본사에서 Call → '줌'으로 안내(전문위원 참여) → 홈페이지 신청완료</p>
                                    </div>
                                </div>
                                
                                <!-- Step 8 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">8</div>
                                    <div class="flex-1 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-3 border border-emerald-200">
                                        <p class="text-sm text-slate-700">신청기업 → <span class="font-semibold text-emerald-700">홈페이지 제작</span> → 완료 (본사)</p>
                                        <p class="text-xs text-slate-500 mt-1 italic">* 제작의뢰시 전문위원 전용 URL 사용</p>
                                    </div>
                                </div>
                                
                                <!-- Step 9 -->
                                <div class="relative flex gap-4 pb-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-sky-500 to-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">9</div>
                                    <div class="flex-1 bg-gradient-to-br from-sky-50 to-blue-50 rounded-xl p-3 border border-sky-200">
                                        <p class="text-sm text-slate-700">제작완료 홈페이지 → <span class="font-semibold text-sky-700">전문위원에게 전달</span></p>
                                    </div>
                                </div>
                                
                                <!-- Step 10 -->
                                <div class="relative flex gap-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-rose-500 to-pink-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">10</div>
                                    <div class="flex-1 bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-3 border border-rose-200">
                                        <p class="text-sm text-slate-700"><span class="font-semibold text-rose-700">홈페이지 사용안내</span> 및 <span class="font-semibold text-rose-700">컨설팅 진행</span> (전문위원)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 푸터 -->
                        <div class="px-5 py-4 bg-slate-50 border-t">
                            <button type="button" onclick="closeProcessModal()" class="w-full py-3 bg-gradient-to-r from-violet-700 to-purple-800 hover:from-violet-800 hover:to-purple-900 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl">닫기</button>
                        </div>
                    </div>
                </div>
                
                <!-- Fax안내문 모달 -->
                <div id="fax-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                        <div class="bg-gradient-to-r from-amber-500 to-orange-600 text-white px-6 py-4 flex justify-between items-center">
                            <h3 class="text-xl font-bold">📠 Fax 안내문</h3>
                            <button onclick="closeFaxModal()" class="text-white hover:text-amber-200 text-2xl font-bold">&times;</button>
                        </div>
                        <div class="px-4 pt-4 pb-2">
                            <a href="https://mozilla.github.io/pdf.js/web/viewer.html?file=https://researchtm.netlify.app/fax.pdf" target="_blank" class="block w-full py-3 bg-sky-600 text-white font-bold rounded-lg hover:bg-sky-700 text-center">📱 새창에서 보기 (확대 가능)</a>
                        </div>
                        <div class="px-4 pb-4 hidden md:block" style="height: 65vh;">
                            <iframe src="https://mozilla.github.io/pdf.js/web/viewer.html?file=https://researchtm.netlify.app/fax.pdf" class="w-full h-full border rounded-lg" frameborder="0"></iframe>
                        </div>
                        <div class="px-4 pb-4 md:hidden text-center text-slate-500 text-sm">
                            <p>위 버튼을 눌러 PDF를 확인하세요.<br>손가락으로 확대/축소가 가능합니다.</p>
                        </div>
                        <div class="px-6 pb-4">
                            <button onclick="closeFaxModal()" class="w-full py-3 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-bold rounded-xl transition-all">닫기</button>
                        </div>
                    </div>
                </div>
                
                <!-- Call도움메세지 모달 -->
                <div id="callhelp-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
                        <div class="bg-gradient-to-r from-rose-500 to-pink-600 text-white px-6 py-4">
                            <h3 class="text-xl font-bold text-center">📞 Fax전송 후 Call 진행시 도움되는 내용들</h3>
                        </div>
                        <div class="p-5 overflow-y-auto max-h-[65vh] space-y-4">
                            <div class="bg-gradient-to-r from-rose-50 to-pink-50 rounded-xl p-4 border-l-4 border-rose-500">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-lg">♣</span>
                                    <span class="font-bold text-rose-700">나의 소개</span>
                                </div>
                                <p class="text-slate-700 pl-6">기업경영연구소의 컨설팅 전문위원입니다.</p>
                            </div>
                            <div class="bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl p-4 border-l-4 border-amber-500">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-lg">♣</span>
                                    <span class="font-bold text-amber-700">아래 내용은 통화에 도움됩니다.</span>
                                </div>
                                <p class="text-slate-600 pl-6 text-sm italic">➜ 아래 내용을 여러 번 읽고 숙지하시면 도움이 됩니다.(반드시 소리내서 한 5회 정도?)</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span><p class="text-slate-700">일반직원(여직원 등)과 길게 얘기하지 않습니다.</p></div>
                                </div>
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span><div><p class="text-slate-700">일반직원과는 Fax 수신여부 확인만 합니다.</p><p class="text-rose-600 text-sm mt-1 pl-2 border-l-2 border-rose-300">☞ 오전에 저희 연구소에서 Fax를 하나 보내드렸는데 혹시 받으셨나요?</p></div></div>
                                </div>
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span><div><p class="text-slate-700">일반직원이 Fax내용에 대해 문의하는 경우 간단하게 답변합니다.</p><p class="text-rose-600 text-sm mt-1 pl-2 border-l-2 border-rose-300">☞ 국내 연구소 보유기업 중에서 홈페이지가 없는 기업만을 대상으로 보낸 것이고, 안에 구축비 1,000만원 면제 등 특별한 프로모션 내용들이 있어서 대표님께서 보시고 판단하시면 좋겠다. 아마도 좋은 기회가 될 것입니다.</p></div></div>
                                </div>
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</span><p class="text-slate-700">일반직원에게는 대표님 혹은 연구소 책임자에게 Fax안내문 전달을 요청하면서 연결 부탁합니다.</p></div>
                                </div>
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">5</span><p class="text-slate-700">일반적으로 전화 받는 직원의 지근거리에 Fax가 있어서 전송 후 2~3시간이면 Fax안내문을 거의 확인했을 확률이 높습니다.</p></div>
                                </div>
                                <div class="bg-amber-50 rounded-lg p-3 border border-amber-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold">6</span><p class="text-slate-700"><strong class="text-amber-700">Fax는 당일 오전 11시에 전송됩니다. Call은 오후 1시~2시 사이에 시작합니다.</strong></p></div>
                                </div>
                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-rose-500 text-white rounded-full flex items-center justify-center text-sm font-bold">7</span><p class="text-slate-700">대표와의 통화시 홈페이지 및 탑재된 시스템에 대하여 간략한 특징만 언급합니다.(관심 여부만 체크)</p></div>
                                </div>
                                <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-emerald-500 text-white rounded-full flex items-center justify-center text-sm font-bold">8</span><p class="text-slate-700">대표가 홈페이지와 추가 시스템에 조금 관심을 보이면 <strong class="text-emerald-700">시스템구축비 1,000만원 면제, 초기셋팅비 100만원 전액면제, 이용전기간 웹호스팅비 전액 본사부담</strong> 등.. 홈페이지를 장만하실 수 있는 아주 좋은 기회라는 것을 어필합니다.</p></div>
                                </div>
                                <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-emerald-500 text-white rounded-full flex items-center justify-center text-sm font-bold">9</span><p class="text-slate-700">이러한 큰 혜택은 본사에서 시스템 런칭기념으로 <strong class="text-emerald-700">연구소보유기업 중 홈페이지가 없는 기업들에 한정</strong>해서 진행하는 것임을 강조합니다.</p></div>
                                </div>
                                <div class="bg-sky-50 rounded-lg p-3 border border-sky-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-sky-500 text-white rounded-full flex items-center justify-center text-sm font-bold">10</span><p class="text-slate-700">관심을 보이는 대표에게는 바로 <strong class="text-sky-700">본사의 책임연구원(박신제 본부장)</strong> 통해서 연락한 번 드려서 상세하게 설명 드릴 수 있도록 하겠다.고 얘기하면서 <strong class="text-sky-700">대표성명과 연락처를 바로 요청</strong>합니다.</p></div>
                                </div>
                                <div class="bg-sky-50 rounded-lg p-3 border border-sky-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-sky-500 text-white rounded-full flex items-center justify-center text-sm font-bold">11</span><p class="text-slate-700">10번 항목을 얘기하면서 <strong class="text-sky-700">아마 설명을 들으시면 회사 운영에 큰 도움이 되실 것</strong>이라고 첨언합니다.</p></div>
                                </div>
                                <div class="bg-violet-50 rounded-lg p-3 border border-violet-200">
                                    <div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-violet-500 text-white rounded-full flex items-center justify-center text-sm font-bold">12</span><p class="text-slate-700">자료나 제안서 등 요청을 하는 경우에도 단순히 홈페이지가 아니구요.. 대표님께서 생각하시는 것 보다 상당히 다양한 시스템들이 장착되어 있어서 <strong class="text-violet-700">본사의 책임연구원 통해서 설명을 들으시고 난 후 받아보시면 많이 도움되실 것</strong>이라고 얘기하면서 본사 담당자와의 설명 듣는 시간을 요청합니다.</p></div>
                                </div>
                            </div>
                        </div>
                        <div class="px-5 py-4 bg-slate-50 border-t">
                            <button onclick="closeCallHelpModal()" class="w-full py-3 bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-700 hover:to-pink-700 text-white font-bold rounded-xl transition-all">닫기</button>
                        </div>
                    </div>
                </div>
                
                <script>
                    function showProcessModal() {
                        document.getElementById('process-modal').classList.remove('hidden');
                    }
                    function closeProcessModal() {
                        document.getElementById('process-modal').classList.add('hidden');
                    }
                    function showFeaturesModal() {
                        document.getElementById('features-modal').classList.remove('hidden');
                    }
                    function closeFeaturesModal() {
                        document.getElementById('features-modal').classList.add('hidden');
                    }
                    function showPriceTableModal() {
                        document.getElementById('price-table-modal').classList.remove('hidden');
                    }
                    function closePriceTableModal() {
                        document.getElementById('price-table-modal').classList.add('hidden');
                    }
                    function showFaxModal() {
                        document.getElementById('fax-modal').classList.remove('hidden');
                    }
                    function closeFaxModal() {
                        document.getElementById('fax-modal').classList.add('hidden');
                    }
                    function showCallHelpModal() {
                        document.getElementById('callhelp-modal').classList.remove('hidden');
                    }
                    function closeCallHelpModal() {
                        document.getElementById('callhelp-modal').classList.add('hidden');
                    }
                    document.addEventListener('DOMContentLoaded', function() {
                        document.getElementById('price-table-modal')?.addEventListener('click', function(e) {
                            if (e.target === this) closePriceTableModal();
                        });
                        document.getElementById('features-modal')?.addEventListener('click', function(e) {
                            if (e.target === this) closeFeaturesModal();
                        });
                        document.getElementById('process-modal')?.addEventListener('click', function(e) {
                            if (e.target === this) closeProcessModal();
                        });
                        document.getElementById('fax-modal')?.addEventListener('click', function(e) {
                            if (e.target === this) closeFaxModal();
                        });
                        document.getElementById('callhelp-modal')?.addEventListener('click', function(e) {
                            if (e.target === this) closeCallHelpModal();
                        });
                    });
                </script>
            </div>
        </div>
    </div>

    <!-- 관리자 페이지 -->
    <div id="admin-page" class="hidden">
        <div class="full-width-container">
            <header class="mb-4 flex flex-wrap justify-between items-center gap-4">
                <div><h1 class="text-2xl md:text-3xl font-bold text-slate-800">관리자 페이지</h1></div>
                <div class="flex gap-2">
                    <button onclick="showPage('TM-DB-Table')" class="py-2 px-4 text-sm font-semibold rounded-lg text-slate-700 bg-slate-200 hover:bg-slate-300 transition">DB 현황</button>
                    <button onclick="logout()" class="py-2 px-4 text-sm font-semibold rounded-lg text-red-600 bg-red-100 hover:bg-red-200 transition">로그아웃</button>
                </div>
            </header>
            <div class="bg-white rounded-xl shadow-lg mb-4">
                <div class="p-4 border-b"><h2 class="text-lg font-semibold text-slate-800">관리자 정보 변경</h2></div>
                <form id="admin-credential-form" class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div>
                            <label for="new-admin-id" class="text-sm font-semibold text-slate-700">새로운 아이디</label>
                            <input id="new-admin-id" type="text" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border rounded-md">
                        </div>
                        <div>
                            <label for="new-admin-pw" class="text-sm font-semibold text-slate-700">새로운 비밀번호</label>
                            <input id="new-admin-pw" type="password" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border rounded-md">
                        </div>
                        <div><button type="submit" class="w-full py-2 px-4 font-bold rounded-lg text-white bg-slate-800 hover:bg-slate-900">저장</button></div>
                    </div>
                </form>
            </div>
            <!-- 스케줄 관리 섹션 -->
            <div class="bg-white rounded-xl shadow-lg mb-4">
                <div class="p-4 border-b"><h2 class="text-lg font-semibold text-slate-800">📅 다음 주 전문위원 스케줄</h2></div>
                <div class="p-4">
                    <!-- 검색 및 선택삭제 -->
                    <div class="flex flex-wrap gap-2 mb-4 items-center justify-between">
                        <div class="flex gap-2 items-center">
                            <input type="text" id="schedule-search" placeholder="전문위원 성명 검색" class="px-3 py-2 border rounded-lg text-sm w-48" autocomplete="off" onkeyup="if(event.key==='Enter') filterAdminSchedule()">
                            <button onclick="filterAdminSchedule()" class="px-3 py-2 bg-slate-600 text-white text-sm rounded-lg hover:bg-slate-700">검색</button>
                        </div>
                        <button onclick="deleteSelectedSchedules()" class="px-3 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600">선택 삭제</button>
                    </div>
                    <div id="admin-schedule-container" class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-600">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-center"><input type="checkbox" id="schedule-select-all" onclick="toggleAllSchedules(this)"></th>
                                    <th class="px-4 py-3">전문위원</th>
                                    <th class="px-4 py-3">신청일자</th>
                                    <th class="px-4 py-3">상태</th>
                                    <th class="px-4 py-3">처리일시</th>
                                    <th class="px-4 py-3 text-center">관리</th>
                                </tr>
                            </thead>
                            <tbody id="admin-schedule-body"></tbody>
                        </table>
                    </div>
                    <!-- 스케줄 페이지네이션 -->
                    <div id="schedule-pagination" class="flex justify-center items-center gap-2 mt-4"></div>
                    <p id="no-schedule-msg" class="text-center py-8 text-slate-500 hidden">신청된 스케줄이 없습니다.</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-4 border-b"><h2 class="text-lg font-semibold text-slate-800">회원 정보 현황</h2></div>
                <div class="p-4">
                    <!-- TM/Fax 필터 버튼 및 검색 -->
                    <div class="flex flex-wrap gap-2 mb-4 items-center justify-between">
                        <div class="flex gap-2 items-center">
                            <button onclick="filterUsersByType('all')" id="user-filter-all" class="px-4 py-2 text-sm font-semibold rounded-lg bg-slate-800 text-white">전체</button>
                            <button onclick="filterUsersByType('TM')" id="user-filter-tm" class="px-4 py-2 text-sm font-semibold rounded-lg bg-slate-200 text-slate-700 hover:bg-slate-300">TM</button>
                            <button onclick="filterUsersByType('Fax')" id="user-filter-fax" class="px-4 py-2 text-sm font-semibold rounded-lg bg-slate-200 text-slate-700 hover:bg-slate-300">Fax</button>
                        </div>
                        <div class="flex gap-2 items-center">
                            <input type="text" id="user-search" placeholder="성명 검색" class="px-3 py-2 border rounded-lg text-sm w-40" autocomplete="off" onkeyup="if(event.key==='Enter') filterAdminUsers()">
                            <button onclick="filterAdminUsers()" class="px-3 py-2 bg-slate-600 text-white text-sm rounded-lg hover:bg-slate-700">검색</button>
                        </div>
                    </div>
                </div>
                <div class="w-full overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-600">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th class="px-3 py-3">구분</th>
                                <th class="px-3 py-3">성명</th>
                                <th class="px-3 py-3">전화번호</th>
                                <th class="px-3 py-3">소속사</th>
                                <th class="px-3 py-3">지역</th>
                                <th class="px-3 py-3">멤버십</th>
                                <th class="px-3 py-3">비번변경</th>
                                <th class="px-3 py-3">TM</th>
                                <th class="px-3 py-3">Fax</th>
                                <th class="px-3 py-3">비고</th>
                                <th class="px-3 py-3">안내</th>
                                <th class="px-3 py-3 text-center">관리</th>
                            </tr>
                        </thead>
                        <tbody id="admin-table-body"></tbody>
                    </table>
                </div>
                <!-- 회원 페이지네이션 -->
                <div id="user-pagination" class="flex justify-center items-center gap-2 p-4"></div>
            </div>
        </div>
    </div>
    
    <!-- DB 테이블 페이지 -->
    <div id="TM-DB-Table" class="hidden">
         <div class="full-width-container">
            <header class="mb-4 flex flex-wrap justify-between items-center gap-4">
                <div><h1 class="text-2xl md:text-3xl font-bold text-slate-800">연구소 DB 현황</h1><p id="welcome-user" class="mt-1 text-sm text-slate-500"></p></div>
                <div class="flex gap-2 items-center">
                    <button id="admin-page-button" class="hidden py-2 px-4 text-sm font-semibold rounded-lg text-slate-700 bg-slate-200 hover:bg-slate-300 transition" onclick="showPage('admin-page')">관리자</button>
                    <button onclick="logout()" class="py-2 px-4 text-sm font-semibold rounded-lg text-red-600 bg-red-100 hover:bg-red-200 transition">로그아웃</button>
                </div>
            </header>
            
            <!-- 전문위원 스케줄 신청 섹션 (전문위원만 표시) -->
            <div id="specialist-schedule-section" class="hidden bg-white rounded-xl shadow-lg mb-4">
                <div class="p-4 border-b flex flex-wrap justify-between items-center gap-2">
                    <h2 class="text-lg font-semibold text-slate-800">📅 다음 주 콜 일정 신청</h2>
                    <button onclick="saveSchedule()" class="py-2 px-4 text-sm font-bold rounded-lg text-white bg-amber-500 hover:bg-amber-600">신청하기</button>
                </div>
                <div class="p-4">
                    <div id="schedule-checkboxes" class="flex flex-wrap gap-3 justify-center"></div>
                    <div id="my-schedule-status" class="mt-4 pt-4 border-t">
                        <h3 class="text-sm font-semibold text-slate-700 mb-2">나의 신청 현황</h3>
                        <div id="my-schedule-list" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-3 flex flex-wrap gap-2 justify-between items-center border-b">
                    <div class="flex items-center gap-2">
                        <h2 class="text-lg font-semibold text-slate-800">기업 리스트</h2>
                        <span id="data-count-display" class="text-sm text-slate-500"></span>
                    </div>
                    <div id="filter-container" class="flex items-center gap-2">
                        <select id="search-column-select" class="border rounded-md p-2 text-sm bg-white">
                            <option value="기업명">기업명</option>
                            <option value="담당 전문위원">담당 전문위원</option>
                        </select>
                        <input type="text" id="search-input" class="w-40 md:w-56 border rounded-md p-2 text-sm" placeholder="검색어 입력" onkeydown="if(event.key==='Enter') searchCompany();">
                        <button onclick="searchCompany()" class="py-2 px-3 text-sm font-bold rounded-lg text-white bg-slate-700 hover:bg-slate-800">검색</button>
                        <button onclick="resetSearch()" class="py-2 px-3 text-sm font-semibold rounded-lg text-slate-700 bg-slate-200 hover:bg-slate-300">초기화</button>
                    </div>
                </div>
                <div class="w-full overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-600">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr class="border-b-2">
                                <th colspan="11" class="px-4 py-2 font-bold text-center bg-blue-100 text-blue-800">기업 기본정보</th>
                                <th colspan="6" class="px-4 py-2 font-bold text-center bg-green-100 text-green-800">전문위원 입력</th>
                                <th colspan="2" class="px-4 py-2 font-bold text-center bg-amber-100 text-amber-800">본사</th>
                            </tr>
                            <tr class="border-b">
                                <!-- A~K열: 기업 기본정보 -->
                                <th class="px-3 py-2 min-w-[50px]">No</th>
                                <th class="px-3 py-2 min-w-[150px]">기업명</th>
                                <th class="px-3 py-2 min-w-[100px]">업종</th>
                                <th class="px-3 py-2 min-w-[80px]">기업규모</th>
                                <th class="px-3 py-2 min-w-[200px]">회사주소</th>
                                <th class="px-3 py-2 min-w-[200px]">연구소주소</th>
                                <th class="px-3 py-2 min-w-[80px]">구분</th>
                                <th class="px-3 py-2 min-w-[120px]">회사Tel</th>
                                <th class="px-3 py-2 min-w-[120px]">회사Fax</th>
                                <th class="px-3 py-2 min-w-[80px]">대표자명</th>
                                <th class="px-3 py-2 min-w-[100px]">담당전문위원</th>
                                <!-- 전문위원 입력항목 (6개) -->
                                <th class="px-3 py-2 min-w-[90px]">콜일자</th>
                                <th class="px-3 py-2 min-w-[80px]">통화대상자</th>
                                <th class="px-3 py-2 min-w-[70px]">직함</th>
                                <th class="px-3 py-2 min-w-[200px]">통화내용</th>
                                <th class="px-3 py-2 min-w-[100px]">본사상담요청</th>
                                <th class="px-3 py-2 min-w-[100px]">홈피안내일</th>
                                <!-- 본사 입력항목 (2개) -->
                                <th class="px-3 py-2 min-w-[150px]">홈페이지url</th>
                                <th class="px-3 py-2 min-w-[200px]">본사메모</th>
                            </tr>
                        </thead>
                        <tbody id="db-table-body"></tbody>
                    </table>
                </div>
                <div id="pagination-controls" class="p-3 flex justify-center items-center gap-2 border-t">
                    <div id="page-buttons-container" class="flex items-center gap-1"></div>
                    <div id="page-jump-container" class="flex items-center gap-2 ml-4">
                        <input type="number" id="page-jump-input" class="w-16 border rounded-md p-2 text-sm" placeholder="페이지" onkeydown="if(event.key==='Enter') jumpToPage();">
                        <button onclick="jumpToPage()" class="px-3 py-2 rounded-md text-sm font-medium bg-slate-600 text-white hover:bg-slate-700">이동</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 상세 정보 모달 -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="w-full max-w-5xl bg-white rounded-2xl shadow-xl flex flex-col max-h-[90vh]">
            <header class="p-6 border-b flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-bold text-slate-800">상세 정보 입력</h2>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </header>

            <div id="modal-warning" class="hidden p-4 text-sm text-amber-800 bg-amber-100 text-center font-semibold"></div>

            <div class="p-8 modal-body overflow-y-auto">
                <form id="edit-form" onkeydown="handleEnterKey(event)">
                    <input name="originalIndex" type="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
                        
                        <!-- 기업 기본정보 (A~K열) -->
                        <fieldset id="company-info-fieldset" class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
                            <legend class="lg:col-span-3 font-bold text-lg text-blue-800 border-b-2 border-blue-200 pb-2 mb-4">기업 기본정보</legend>
                            <input name="No" type="hidden">
                            <div><label class="font-semibold">기업명</label><input name="기업명" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">업종</label><input name="업종" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">기업규모</label><input name="기업규모" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div class="lg:col-span-3"><label class="font-semibold">회사주소</label><input name="회사주소" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div class="lg:col-span-3"><label class="font-semibold">연구소주소</label><input name="연구소주소" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">구분</label><input name="구분" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">회사Tel</label><input name="회사Tel" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">회사Fax</label><input name="회사Fax" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">대표자명</label><input name="대표자명" type="text" class="w-full p-2 mt-1 border rounded" readonly></div>
                            <div><label class="font-semibold">담당 전문위원</label><input name="담당 전문위원" type="text" class="w-full p-2 mt-1 border rounded bg-gray-100" readonly></div>
                        </fieldset>
                        
                        <!-- 전문위원 입력항목 -->
                        <fieldset id="specialist-fieldset" class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
                            <legend class="lg:col-span-3 font-bold text-lg text-green-800 border-b-2 border-green-200 pb-2 mb-4 mt-6">전문위원 입력항목</legend>
                            <div>
                                <label class="font-semibold flex items-center">콜일자</label>
                                <input name="콜일자" type="date" class="w-full p-2 mt-1 border rounded">
                            </div>
                            <div>
                                <label class="font-semibold flex items-center">통화대상자</label>
                                <input name="통화대상자" type="text" class="w-full p-2 mt-1 border rounded">
                            </div>
                            <div>
                                <label class="font-semibold flex items-center">직함</label>
                                <input name="직함" type="text" list="job-title-list" class="w-full p-2 mt-1 border rounded" placeholder="선택 또는 직접입력">
                                <datalist id="job-title-list">
                                    <option value="대표">
                                    <option value="연구소장">
                                    <option value="책임자">
                                    <option value="부장">
                                    <option value="기타">
                                </datalist>
                            </div>
                            <div class="lg:col-span-3">
                                <label class="font-semibold flex items-center">통화내용_전문위원</label>
                                <textarea name="통화내용_전문위원" rows="3" class="w-full p-2 mt-1 border rounded" placeholder="누구와 어떤 내용을 어느정도 대화를 하였는지 그리고 홈페이지에 대한 반응, 기대치 등을 상세하게 입력바랍니다. 본내용을 보고 본사 담당자가 회사에 연락하여 유선 혹은 줌으로 일정을 잡고 클로징을 진행합니다."></textarea>
                            </div>
                            <div>
                                <label class="font-semibold flex items-center">본사상담요청</label>
                                <select name="본사상담요청" class="w-full p-2 mt-1 border rounded">
                                    <option value="">선택</option>
                                    <option value="요청(관심도_높음)">요청(관심도_높음)</option>
                                    <option value="요청(관심도_보통)">요청(관심도_보통)</option>
                                    <option value="요청(관심도_낮음)">요청(관심도_낮음)</option>
                                    <option value="대상아님">대상아님</option>
                                    <option value="추후진행">추후진행</option>
                                </select>
                            </div>
                            <div>
                                <label class="font-semibold flex items-center">홈페이지안내일자</label>
                                <input name="홈페이지안내일자" type="date" class="w-full p-2 mt-1 border rounded">
                            </div>
                        </fieldset>
                        
                        <!-- 본사 입력항목 -->
                        <fieldset id="hq-fieldset" class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
                            <legend class="lg:col-span-3 font-bold text-lg text-amber-800 border-b-2 border-amber-200 pb-2 mb-4 mt-6">본사 입력항목</legend>
                            <div>
                                <label class="font-semibold flex items-center">홈페이지url</label>
                                <input name="홈페이지url" type="text" class="w-full p-2 mt-1 border rounded">
                            </div>
                            <div class="lg:col-span-2">
                                <label class="font-semibold flex items-center">본사담당자메모</label>
                                <textarea name="본사담당자메모" rows="2" class="w-full p-2 mt-1 border rounded"></textarea>
                            </div>
                        </fieldset>
                        
                    </div>
                </form>
            </div>
            <footer class="p-6 border-t flex justify-between items-center gap-4">
                <button id="delete-button" onclick="deleteCompany()" class="hidden py-3 px-6 font-bold rounded-lg text-red-600 bg-red-100 hover:bg-red-200 transition">삭제</button>
                <div class="flex gap-4 ml-auto">
                    <button type="button" onclick="closeEditModal()" class="py-3 px-8 font-bold rounded-lg text-slate-700 bg-slate-200 hover:bg-slate-300">취소</button>
                    <button type="button" onclick="saveModalData()" class="py-3 px-8 font-bold rounded-lg text-white bg-slate-800 hover:bg-slate-900">저장</button>
                </div>
            </footer>
        </div>
    </div>

<script>
    // === 전역 변수 ===
    const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbxT_jFERIyCqadOsT1FQxNu-L-tclH7FT87czgrtZey_PzTVp0S2HRzoJ5F-e1iS8ow/exec';
    let loggedInUser = null;
    let tempPassword = null;
    let allUsers = [];
    let allCompanies = [];
    let cachedAllCompanies = []; // 전체 데이터 캐시
    let totalCompanies = 0;
    let currentPage = 1;
    const companiesLimit = 10; // 한 화면에 10행 표시
    let currentFilter = {};
    
    // 회원 관리 관련 변수
    let userCurrentPage = 1;
    const userPageLimit = 10;
    let userTypeFilter = 'all';
    let userSearchKeyword = '';
    let filteredUsers = [];
    
    // 스케줄 관리 관련 변수
    let scheduleCurrentPage = 1;
    const schedulePageLimit = 10;
    let scheduleSearchKeyword = '';
    let filteredSchedules = [];
    let allSchedules = [];

    // === API 호출 ===
    const apiCache = {};
    function showLoading() { document.getElementById('loading-overlay').classList.remove('hidden'); }
    function hideLoading() { document.getElementById('loading-overlay').classList.add('hidden'); }

    async function callAPI(action, sheet, data = {}) {
        // 캐시 확인 (readAll만 캐싱)
        if (action === 'readAll' && apiCache[sheet]) {
            return apiCache[sheet];
        }
        
        showLoading();
        try {
            const response = await fetch(GAS_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify({ action, sheet, ...data })
            });
            const result = await response.json();
            if (result.error) {
                console.error('API Error:', result.error);
                alert('오류 발생: ' + result.error);
                return null;
            }
            
            // 캐시 저장 (readAll만)
            if (action === 'readAll') {
                apiCache[sheet] = result;
            }
            
            // 캐시 무효화 (데이터 변경 시)
            if (['write', 'update', 'delete'].includes(action)) {
                delete apiCache[sheet];
            }
            
            return result;
        } catch (error) {
            console.error('Fetch Error:', error);
            alert('서버와 통신 중 오류가 발생했습니다.');
            return null;
        } finally {
            hideLoading();
        }
    }

    // === 페이지 이동 ===
    function showPage(pageId) {
        document.querySelectorAll('body > div[id$="-page"], body > div[id="TM-DB-Table"], body > div[id="admin-page"]').forEach(p => p.classList.add('hidden'));
        document.getElementById(pageId)?.classList.remove('hidden');
        if (pageId === 'TM-DB-Table' && loggedInUser) {
            loadInitialData();
            if (loggedInUser.role === '전문위원') renderScheduleUI();
        }
        if (pageId === 'admin-page' && loggedInUser) {
            renderAdminTable();
            renderAdminSchedule();
        }
    }
    window.showPage = showPage;

    function logout() {
        loggedInUser = null;
        sessionStorage.removeItem('loggedInUser');
        allUsers = [];
        allCompanies = [];
        showPage('login-page');
    }
    window.logout = logout;

    // === 로그인 처리 ===
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        
        // admin 로그인 체크
        const adminData = await callAPI('readAll', 'Admin');
        if (adminData && adminData.length > 0) {
            const admin = adminData[0];
            if (admin.id === username && String(admin.pw) === password) {
                loggedInUser = { name: '관리자', role: 'admin' };
                sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                showPage('admin-page');
                return;
            }
        }
        
        // 일반 사용자 로그인 체크
        const users = await callAPI('readAll', 'Users');
        if (users) {
            allUsers = users;
            const user = users.find(u => u.name === username && u.phone === password);
            if (user) {
                loggedInUser = user;
                sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                
                // 최초 로그인 시 비밀번호 변경 필요 체크
                if (!user.passwordChanged || user.passwordChanged === 'false' || user.passwordChanged === false) {
                    tempPassword = password;
                    document.getElementById('force-password-modal').classList.remove('hidden');
                } else {
                    showPage('TM-DB-Table');
                }
            } else {
                alert('아이디 또는 비밀번호가 일치하지 않습니다.');
            }
        }
    });

    // === 최초 로그인 비밀번호 강제 변경 ===
    async function saveForcePasswordChange() {
        const newPassword = document.getElementById('force-new-password').value;
        const confirmPassword = document.getElementById('force-new-password-confirm').value;
        
        if (!newPassword || !confirmPassword) {
            alert('비밀번호를 입력해주세요.');
            return;
        }
        
        if (newPassword.length < 4) {
            alert('비밀번호는 4자 이상이어야 합니다.');
            return;
        }
        
        if (newPassword !== confirmPassword) {
            alert('비밀번호가 일치하지 않습니다.');
            return;
        }
        
        // 기존 비밀번호와 동일한지 체크
        if (newPassword === tempPassword) {
            alert('기존 비밀번호와 다른 비밀번호를 입력해주세요.');
            return;
        }
        
        // 비밀번호 변경 API 호출
        const result = await callAPI('update', 'Users', {
            rowIndex: loggedInUser.originalIndex,
            data: {
                phone: newPassword,
                passwordChanged: true
            }
        });
        
        if (result && result.success) {
            loggedInUser.phone = newPassword;
            loggedInUser.passwordChanged = true;
            tempPassword = null;
            sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
            document.getElementById('force-password-modal').classList.add('hidden');
            document.getElementById('force-new-password').value = '';
            document.getElementById('force-new-password-confirm').value = '';
            alert('비밀번호가 변경되었습니다. 환영합니다!');
            showPage('TM-DB-Table');
        } else {
            alert('비밀번호 변경에 실패했습니다.');
        }
    }
    window.saveForcePasswordChange = saveForcePasswordChange;

    // === 관리자 정보 변경 ===
    document.getElementById('admin-credential-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const newId = document.getElementById('new-admin-id').value.trim();
        const newPw = document.getElementById('new-admin-pw').value.trim();
        if (newId && newPw) {
            const result = await callAPI('update', 'Admin', { data: { id: newId, pw: newPw }, rowIndex: 2 });
            alert('관리자 정보가 성공적으로 변경되었습니다.');
        } else {
            alert('새로운 아이디와 비밀번호를 모두 입력해주세요.');
        }
    });

    // === 관리자 테이블 렌더링 ===
    async function renderAdminTable() {
        await loadUsers();
        // 검색창 초기화
        const searchInput = document.getElementById('user-search');
        if (searchInput) searchInput.value = '';
        filterAdminUsers();
    }
    
    function filterAdminUsers() {
        userSearchKeyword = document.getElementById('user-search')?.value.trim().toLowerCase() || '';
        
        // 필터링 적용
        filteredUsers = allUsers.filter(user => {
            // TM/Fax 필터
            if (userTypeFilter === 'TM' && !user.TM) return false;
            if (userTypeFilter === 'Fax' && !user.Fax) return false;
            
            // 검색 필터
            if (userSearchKeyword && !user.name.toLowerCase().includes(userSearchKeyword)) return false;
            
            return true;
        });
        
        userCurrentPage = 1;
        renderFilteredUsers();
    }
    window.filterAdminUsers = filterAdminUsers;
    
    function filterUsersByType(type) {
        userTypeFilter = type;
        
        // 버튼 스타일 업데이트
        document.getElementById('user-filter-all').className = 'px-4 py-2 text-sm font-semibold rounded-lg ' + (type === 'all' ? 'bg-slate-800 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300');
        document.getElementById('user-filter-tm').className = 'px-4 py-2 text-sm font-semibold rounded-lg ' + (type === 'TM' ? 'bg-slate-800 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300');
        document.getElementById('user-filter-fax').className = 'px-4 py-2 text-sm font-semibold rounded-lg ' + (type === 'Fax' ? 'bg-slate-800 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300');
        
        filterAdminUsers();
    }
    window.filterUsersByType = filterUsersByType;
    
    function renderFilteredUsers() {
        const tableBody = document.getElementById('admin-table-body');
        tableBody.innerHTML = '';
        
        if (filteredUsers.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="12" class="text-center py-16 text-slate-500">등록된 회원이 없습니다.</td></tr>`;
            document.getElementById('user-pagination').innerHTML = '';
            return;
        }
        
        // 페이지네이션 계산
        const totalPages = Math.ceil(filteredUsers.length / userPageLimit);
        const start = (userCurrentPage - 1) * userPageLimit;
        const end = start + userPageLimit;
        const pageUsers = filteredUsers.slice(start, end);
        
        pageUsers.forEach((member) => {
            const row = document.createElement('tr');
            row.className = 'bg-white border-b';
            row.id = `user-row-${member.originalIndex}`;
            row.innerHTML = getUserRowHtml(member);
            tableBody.appendChild(row);
        });
        
        // 페이지네이션 렌더링
        renderUserPagination(totalPages);
    }
    
    function renderUserPagination(totalPages) {
        const container = document.getElementById('user-pagination');
        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        let html = '';
        html += `<button onclick="goUserPage(${userCurrentPage - 1})" class="px-3 py-1 rounded ${userCurrentPage === 1 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300'}" ${userCurrentPage === 1 ? 'disabled' : ''}>이전</button>`;
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= userCurrentPage - 2 && i <= userCurrentPage + 2)) {
                html += `<button onclick="goUserPage(${i})" class="px-3 py-1 rounded ${i === userCurrentPage ? 'bg-slate-800 text-white' : 'bg-slate-200 hover:bg-slate-300'}">${i}</button>`;
            } else if (i === userCurrentPage - 3 || i === userCurrentPage + 3) {
                html += `<span class="px-2">...</span>`;
            }
        }
        
        html += `<button onclick="goUserPage(${userCurrentPage + 1})" class="px-3 py-1 rounded ${userCurrentPage === totalPages ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300'}" ${userCurrentPage === totalPages ? 'disabled' : ''}>다음</button>`;
        
        container.innerHTML = html;
    }
    
    function goUserPage(page) {
        const totalPages = Math.ceil(filteredUsers.length / userPageLimit);
        if (page < 1 || page > totalPages) return;
        userCurrentPage = page;
        renderFilteredUsers();
    }
    window.goUserPage = goUserPage;

    function getUserRowHtml(member) {
        return `
            <td class="px-3 py-3 font-semibold">${member.role || ''}</td>
            <td class="px-3 py-3">${member.name || ''}</td>
            <td class="px-3 py-3">${member.phone || ''}</td>
            <td class="px-3 py-3">${member.company || ''}</td>
            <td class="px-3 py-3">${member.region || ''}</td>
            <td class="px-3 py-3">${member.Membership || ''}</td>
            <td class="px-3 py-3">${member.passwordChanged ? '✅' : ''}</td>
            <td class="px-3 py-3">${member.TM || ''}</td>
            <td class="px-3 py-3">${member.Fax || ''}</td>
            <td class="px-3 py-3">${member['비고'] || ''}</td>
            <td class="px-3 py-3">${member['안내'] || ''}</td>
            <td class="px-3 py-3 text-center">
                <div class="flex justify-center items-center gap-2">
                    <button onclick="editUser(${member.originalIndex})" class="font-semibold text-blue-600 hover:text-blue-800">수정</button>
                    <button onclick="deleteUser(${member.originalIndex})" class="font-semibold text-red-500 hover:text-red-700">삭제</button>
                </div>
            </td>
        `;
    }

    function getEditUserRowHtml(member) {
        return `
            <td class="px-2 py-2">
                <select name="role" class="w-full p-1 border rounded bg-slate-50 text-xs">
                    <option value="전문위원" ${member.role === '전문위원' ? 'selected' : ''}>전문위원</option>
                    <option value="TMer" ${member.role === 'TMer' ? 'selected' : ''}>TMer</option>
                </select>
            </td>
            <td class="px-2 py-2"><input name="name" type="text" value="${member.name || ''}" class="w-full p-1 border rounded bg-gray-200 text-xs" readonly></td>
            <td class="px-2 py-2"><input name="phone" type="text" value="${member.phone || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="company" type="text" value="${member.company || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="region" type="text" value="${member.region || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="Membership" type="text" value="${member.Membership || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2">
                <select name="passwordChanged" class="w-full p-1 border rounded bg-slate-50 text-xs">
                    <option value="" ${!member.passwordChanged ? 'selected' : ''}></option>
                    <option value="TRUE" ${member.passwordChanged === 'TRUE' || member.passwordChanged === true ? 'selected' : ''}>TRUE</option>
                </select>
            </td>
            <td class="px-2 py-2"><input name="TM" type="text" value="${member.TM || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="Fax" type="text" value="${member.Fax || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="비고" type="text" value="${member['비고'] || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2"><input name="안내" type="text" value="${member['안내'] || ''}" class="w-full p-1 border rounded bg-slate-50 text-xs"></td>
            <td class="px-2 py-2 text-center">
                <div class="flex justify-center items-center gap-1">
                    <button onclick="saveUser(${member.originalIndex})" class="text-xs font-semibold text-green-600 hover:text-green-800">저장</button>
                    <button onclick="renderAdminTable()" class="text-xs font-semibold text-gray-600 hover:text-gray-800">취소</button>
                </div>
            </td>
        `;
    }

    function editUser(originalIndex) {
        const member = allUsers.find(u => u.originalIndex === originalIndex);
        if (!member) return;
        const row = document.getElementById(`user-row-${originalIndex}`);
        row.innerHTML = getEditUserRowHtml(member);
    }
    window.editUser = editUser;

    async function saveUser(originalIndex) {
        const row = document.getElementById(`user-row-${originalIndex}`);
        const originalUser = allUsers.find(u => u.originalIndex === originalIndex);
        const updatedUserData = {
            role: row.querySelector('[name="role"]').value,
            name: row.querySelector('[name="name"]').value,
            phone: row.querySelector('[name="phone"]').value,
            company: row.querySelector('[name="company"]').value,
            region: row.querySelector('[name="region"]').value,
            Membership: row.querySelector('[name="Membership"]').value,
            passwordChanged: row.querySelector('[name="passwordChanged"]').value,
            TM: row.querySelector('[name="TM"]').value,
            Fax: row.querySelector('[name="Fax"]').value,
            '비고': row.querySelector('[name="비고"]').value,
            '안내': row.querySelector('[name="안내"]').value
        };
        const result = await callAPI('update', 'Users', { data: updatedUserData, rowIndex: originalUser.originalIndex });
        if (result && result.success) {
            alert('회원 정보가 수정되었습니다.');
            allUsers = [];
            delete apiCache['Users'];
            await renderAdminTable();
        }
    }
    window.saveUser = saveUser;

    async function deleteUser(originalIndex) {
        const userToDelete = allUsers.find(u => u.originalIndex === originalIndex);
        if (confirm(`'${userToDelete.name}' 회원을 정말로 삭제하시겠습니까?`)) {
            const result = await callAPI('delete', 'Users', { rowIndex: userToDelete.originalIndex });
            if (result && result.success) {
                alert('삭제되었습니다.');
                allUsers = [];
                delete apiCache['Users'];
                await renderAdminTable();
            }
        }
    }
    window.deleteUser = deleteUser;

    // === 데이터 로딩 ===
    async function loadUsers() {
        if (allUsers.length > 0) return;
        const users = await callAPI('readAll', 'Users');
        if (users) allUsers = users;
    }

    async function loadInitialData(page = 1, filter = currentFilter) {
        currentPage = page;
        currentFilter = filter;
        if (allUsers.length === 0) await loadUsers();

        let effectiveFilter = { ...filter };
        
        // 전문위원 로그인 시: W열(담당 전문위원)이 본인 이름인 행만 필터링
        if (loggedInUser.role === '전문위원') {
            effectiveFilter['담당 전문위원'] = loggedInUser.name;
        }

        const result = await callAPI('read', 'Companies', { page, limit: companiesLimit, filter: effectiveFilter });

        if (result) {
            allCompanies = result.data;
            totalCompanies = result.total;
            
            // 캐시 업데이트 (현재 페이지 데이터 추가)
            result.data.forEach(company => {
                const existIdx = cachedAllCompanies.findIndex(c => c.originalIndex === company.originalIndex);
                if (existIdx >= 0) {
                    cachedAllCompanies[existIdx] = company;
                } else {
                    cachedAllCompanies.push(company);
                }
            });
            
            document.getElementById('data-count-display').textContent = `(총 ${totalCompanies}개)`;
            renderDbTable();
            renderPagination();
            document.getElementById('welcome-user').textContent = `${loggedInUser.name}(${loggedInUser.role})님 환영합니다`;
            document.getElementById('admin-page-button').classList.toggle('hidden', loggedInUser.role !== 'admin');
        }
    }

    // === DB 테이블 렌더링 ===
    function renderDbTable() {
        const tableBody = document.getElementById('db-table-body');
        tableBody.innerHTML = '';

        if (allCompanies.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="19" class="text-center py-10 text-slate-500">표시할 기업 정보가 없습니다.</td></tr>`;
            return;
        }

        // 표시할 컬럼
        const headers = [
            '기업명', '업종', '기업규모', '회사주소', '연구소주소', '구분', '회사Tel', '회사Fax', '대표자명', '담당 전문위원',
            '콜일자', '통화대상자', '직함', '통화내용_전문위원', '본사상담요청', '홈페이지안내일자', '홈페이지url',
            '본사담당자메모'
        ];

        allCompanies.forEach((company, index) => {
            const row = document.createElement('tr');
            row.className = 'cursor-pointer hover:bg-amber-50 border-b';
            row.onclick = () => openEditModal(company.originalIndex);

            let rowHtml = `<td class="px-3 py-2 whitespace-nowrap">${(currentPage - 1) * companiesLimit + index + 1}</td>`;
            
            headers.forEach(header => {
                let cellValue = company[header] || '';
                // 긴 텍스트는 줄임
                if (typeof cellValue === 'string' && cellValue.length > 30) {
                    cellValue = cellValue.substring(0, 30) + '...';
                }
                rowHtml += `<td class="px-3 py-2 whitespace-nowrap">${cellValue}</td>`;
            });
            
            row.innerHTML = rowHtml;
            tableBody.appendChild(row);
        });
    }

    // === 페이지네이션 ===
    function renderPagination() {
        const totalPages = Math.ceil(totalCompanies / companiesLimit);
        const controls = document.getElementById('page-buttons-container');
        controls.innerHTML = '';

        if (totalPages <= 1) return;

        const createButton = (text, page, isDisabled = false, isCurrent = false) => {
            const button = document.createElement('button');
            button.innerHTML = text;
            button.disabled = isDisabled;
            let styles = 'px-3 py-1 rounded text-sm font-medium transition-colors ';
            if (isCurrent) styles += 'bg-slate-800 text-white cursor-default';
            else if (isDisabled) styles += 'bg-slate-200 text-slate-400 cursor-not-allowed';
            else styles += 'bg-white text-slate-700 hover:bg-slate-100 border';
            button.className = styles;
            if (!isDisabled && !isCurrent) button.onclick = () => loadInitialData(page);
            return button;
        };

        controls.appendChild(createButton('◀', currentPage - 1, currentPage === 1));

        let startPage, endPage;
        if (totalPages <= 7) { startPage = 1; endPage = totalPages; }
        else {
            if (currentPage <= 4) { startPage = 1; endPage = 7; }
            else if (currentPage + 3 >= totalPages) { startPage = totalPages - 6; endPage = totalPages; }
            else { startPage = currentPage - 3; endPage = currentPage + 3; }
        }

        if (startPage > 1) {
            controls.appendChild(createButton(1, 1));
            if (startPage > 2) controls.insertAdjacentHTML('beforeend', `<span class="px-2">...</span>`);
        }
        for (let i = startPage; i <= endPage; i++) {
            controls.appendChild(createButton(i, i, false, i === currentPage));
        }
        if (endPage < totalPages) {
            if (endPage < totalPages - 1) controls.insertAdjacentHTML('beforeend', `<span class="px-2">...</span>`);
            controls.appendChild(createButton(totalPages, totalPages));
        }

        controls.appendChild(createButton('▶', currentPage + 1, currentPage === totalPages));
    }
    window.renderPagination = renderPagination;

    function jumpToPage() {
        const totalPages = Math.ceil(totalCompanies / companiesLimit);
        const pageInput = document.getElementById('page-jump-input');
        const page = parseInt(pageInput.value);
        if (isNaN(page) || page < 1 || page > totalPages) {
            alert(`1에서 ${totalPages} 사이의 페이지 번호를 입력해주세요.`);
            pageInput.value = '';
            return;
        }
        loadInitialData(page);
    }
    window.jumpToPage = jumpToPage;

    function searchCompany() {
        const column = document.getElementById('search-column-select').value;
        const searchTerm = document.getElementById('search-input').value;
        currentFilter = { [column]: searchTerm };
        loadInitialData(1, currentFilter);
    }
    window.searchCompany = searchCompany;

    function resetSearch() {
        document.getElementById('search-input').value = '';
        currentFilter = {};
        loadInitialData(1, currentFilter);
    }
    window.resetSearch = resetSearch;

    // === 모달 로직 ===
    async function openEditModal(originalIndex) {
        // 먼저 현재 페이지 데이터에서 찾기
        let company = allCompanies.find(c => c.originalIndex === originalIndex);
        
        // 없으면 캐시에서 찾기
        if (!company && cachedAllCompanies.length > 0) {
            company = cachedAllCompanies.find(c => c.originalIndex === originalIndex);
        }
        
        // 그래도 없으면 API 호출
        if (!company) {
            showLoading();
            const fullList = await callAPI('readAll', 'Companies');
            hideLoading();
            if (fullList) {
                cachedAllCompanies = fullList;
                company = fullList.find(c => c.originalIndex === originalIndex);
            }
        }
        
        if (company) {
            const form = document.getElementById('edit-form');
            form.reset();
            
            for (const key in company) {
                if (form.elements[key]) {
                    form.elements[key].value = company[key] || '';
                }
            }
            
            form.elements['originalIndex'].value = originalIndex;
            document.getElementById('modal-title').textContent = `[${company['기업명'] || '미입력'}] 상세 정보`;
            document.getElementById('delete-button').classList.add('hidden');
            
            applyRolePermissions();
            document.getElementById('edit-modal').classList.remove('hidden');
        } else {
            alert('해당 기업 정보를 찾을 수 없습니다.');
        }
    }
    window.openEditModal = openEditModal;

    function openNewCompanyModal() {
        const form = document.getElementById('edit-form');
        form.reset();
        form.elements['originalIndex'].value = '';
        document.getElementById('modal-title').textContent = '신규 기업 등록';
        document.getElementById('delete-button').classList.add('hidden');
        applyRolePermissions();
        document.getElementById('edit-modal').classList.remove('hidden');
    }
    window.openNewCompanyModal = openNewCompanyModal;

    function closeEditModal() {
        document.getElementById('edit-modal').classList.add('hidden');
    }
    window.closeEditModal = closeEditModal;

    async function saveModalData() {
        const form = document.getElementById('edit-form');
        const formData = new FormData(form);
        const newData = {};
        for (let [key, value] of formData.entries()) newData[key] = value;
        
        const originalIndexValue = newData.originalIndex;
        const originalIndex = (originalIndexValue !== '' && !isNaN(parseInt(originalIndexValue))) ? parseInt(originalIndexValue) : null;
        delete newData.originalIndex;

        const action = (originalIndex !== null) ? 'update' : 'write';
        const payload = { data: newData, rowIndex: originalIndex };

        const result = await callAPI(action, 'Companies', payload);

        if (result && result.success) {
            alert('저장되었습니다!');
            closeEditModal();
            cachedAllCompanies = []; // 캐시 초기화
            await loadInitialData(action === 'update' ? currentPage : 1);
        }
    }
    window.saveModalData = saveModalData;

    async function deleteCompany() {
        const originalIndex = document.querySelector('#edit-form input[name="originalIndex"]').value;
        if (originalIndex === '' || originalIndex === null) return;
        if (confirm('정말로 이 기업 정보를 삭제하시겠습니까?')) {
            const result = await callAPI('delete', 'Companies', { rowIndex: parseInt(originalIndex) });
            if (result && result.success) {
                alert('삭제되었습니다.');
                closeEditModal();
                await loadInitialData(1);
            }
        }
    }
    window.deleteCompany = deleteCompany;

    // === 권한 설정 ===
    function applyRolePermissions() {
        const form = document.getElementById('edit-form');
        
        // 기본정보는 항상 읽기 전용
        form.querySelector('#company-info-fieldset').querySelectorAll('input, select, textarea').forEach(el => {
            el.readOnly = true;
            el.disabled = false;
        });
        
        if (loggedInUser.role === 'admin') {
            // 관리자: 모든 필드 편집 가능
            form.querySelectorAll('fieldset').forEach(fs => {
                fs.querySelectorAll('input, select, textarea').forEach(el => {
                    el.readOnly = false;
                    el.disabled = false;
                });
            });
        } else if (loggedInUser.role === '전문위원') {
            // 전문위원: 기본정보 읽기전용, 전문위원 입력항목만 편집 가능
            form.querySelector('#specialist-fieldset').querySelectorAll('input, select, textarea').forEach(el => {
                el.readOnly = false;
                el.disabled = false;
            });
            // 본사 입력항목은 전문위원이 수정 불가
            form.querySelector('#hq-fieldset').querySelectorAll('input, select, textarea').forEach(el => {
                el.readOnly = true;
                el.disabled = false;
                el.classList.add('bg-gray-100');
            });
        }
    }

    function handleEnterKey(event) {
        if (event.key === 'Enter' && event.target.tagName.toLowerCase() !== 'textarea') {
            if (event.target.tagName.toLowerCase() === 'select') return;
            event.preventDefault();
            const form = event.target.form;
            const fields = Array.from(form.querySelectorAll('input:not([readonly]):not([type=hidden]), select, textarea')).filter(el => !el.disabled);
            const currentIndex = fields.indexOf(event.target);
            const nextIndex = currentIndex + 1;
            if (nextIndex < fields.length) fields[nextIndex].focus();
        }
    }
    window.handleEnterKey = handleEnterKey;

    const tooltip = document.getElementById('global-tooltip');
    function showTooltip(iconElement, text) {
        tooltip.innerHTML = text;
        tooltip.style.visibility = 'visible';
        tooltip.style.opacity = '1';
        const rect = iconElement.getBoundingClientRect();
        let top = rect.top - tooltip.offsetHeight - 10;
        if (top < 10) top = rect.bottom + 10;
        let left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2);
        if (left < 10) left = 10;
        else if (left + tooltip.offsetWidth > window.innerWidth - 10) left = window.innerWidth - tooltip.offsetWidth - 10;
        tooltip.style.top = `${top}px`;
        tooltip.style.left = `${left}px`;
    }
    window.showTooltip = showTooltip;

    function hideTooltip() {
        tooltip.style.visibility = 'hidden';
        tooltip.style.opacity = '0';
    }
    window.hideTooltip = hideTooltip;

    // === Schedule 관련 함수 ===
    // 2025-2026 한국 공휴일 목록
    const koreanHolidays = [
        '2025-01-01', '2025-01-28', '2025-01-29', '2025-01-30', // 신정, 설날
        '2025-03-01', '2025-05-05', '2025-05-06', '2025-06-06', // 삼일절, 어린이날, 대체휴일, 현충일
        '2025-08-15', '2025-10-03', '2025-10-05', '2025-10-06', '2025-10-07', // 광복절, 개천절, 추석
        '2025-10-09', '2025-12-25', // 한글날, 성탄절
        '2026-01-01', '2026-02-16', '2026-02-17', '2026-02-18', // 신정, 설날
        '2026-03-01', '2026-03-02', '2026-05-05', '2026-05-24', '2026-06-06', // 삼일절, 대체휴일, 어린이날, 부처님오신날, 현충일
        '2026-08-15', '2026-08-17', '2026-09-24', '2026-09-25', '2026-09-26', // 광복절, 대체휴일, 추석
        '2026-10-03', '2026-10-05', '2026-10-09', '2026-12-25' // 개천절, 대체휴일, 한글날, 성탄절
    ];

    function getNextWeekDates() {
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0(일) ~ 6(토)
        const daysUntilNextMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
        const nextMonday = new Date(today);
        nextMonday.setDate(today.getDate() + daysUntilNextMonday);
        
        const dates = [];
        const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
        for (let i = 0; i < 5; i++) { // 월~금
            const date = new Date(nextMonday);
            date.setDate(nextMonday.getDate() + i);
            const dateStr = date.toISOString().split('T')[0];
            const isHoliday = koreanHolidays.includes(dateStr);
            dates.push({
                date: dateStr,
                display: `${date.getMonth() + 1}/${date.getDate()}(${weekdays[date.getDay()]})`,
                isHoliday: isHoliday
            });
        }
        return dates;
    }

    async function renderScheduleUI() {
        if (loggedInUser.role !== '전문위원') return;
        
        document.getElementById('specialist-schedule-section').classList.remove('hidden');
        
        const container = document.getElementById('schedule-checkboxes');
        const dates = getNextWeekDates();
        
        // 이미 신청된 날짜 목록 가져오기
        const schedules = await callAPI('readAll', 'Schedule');
        const myScheduledDates = schedules 
            ? schedules.filter(s => s['전문위원성명'] === loggedInUser.name).map(s => s['신청일자'])
            : [];
        
        container.innerHTML = dates.map(d => {
            const isAlreadyScheduled = myScheduledDates.includes(d.date);
            const isDisabled = d.isHoliday || isAlreadyScheduled;
            
            return `
            <label class="flex items-center gap-2 p-3 border rounded-lg ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:bg-slate-50'} ${d.isHoliday ? 'bg-red-50' : ''} ${isAlreadyScheduled ? 'bg-slate-100' : ''}">
                <input type="checkbox" name="schedule-date" value="${d.date}" 
                    ${isDisabled ? 'disabled' : ''} class="w-5 h-5 text-amber-500">
                <span class="${d.isHoliday ? 'text-red-500 line-through' : ''}">${d.display}</span>
                ${d.isHoliday ? '<span class="text-xs text-red-500">(공휴일)</span>' : ''}
                ${isAlreadyScheduled ? '<span class="text-xs text-slate-500">(신청완료)</span>' : ''}
            </label>
        `}).join('');
        
        await renderMyScheduleStatus();
    }

    async function renderMyScheduleStatus() {
        const listContainer = document.getElementById('my-schedule-list');
        const schedules = await callAPI('readAll', 'Schedule');
        
        if (!schedules || schedules.length === 0) {
            listContainer.innerHTML = '<span class="text-sm text-slate-500">신청 내역이 없습니다.</span>';
            return;
        }
        
        const mySchedules = schedules.filter(s => s['전문위원성명'] === loggedInUser.name);
        
        if (mySchedules.length === 0) {
            listContainer.innerHTML = '<span class="text-sm text-slate-500">신청 내역이 없습니다.</span>';
            return;
        }
        
        listContainer.innerHTML = mySchedules.map(s => {
            const status = s['상태'] || '신청';
            let statusClass = 'bg-yellow-100 text-yellow-800';
            let statusIcon = '⏳';
            if (status === '확정') {
                statusClass = 'bg-green-100 text-green-800';
                statusIcon = '✅';
            } else if (status === '취소') {
                statusClass = 'bg-red-100 text-red-800';
                statusIcon = '❌';
            }
            return `<span class="px-3 py-1 rounded-full text-sm ${statusClass}">${statusIcon} ${s['신청일자']} (${status})</span>`;
        }).join('');
    }

    async function saveSchedule() {
        const checkboxes = document.querySelectorAll('input[name="schedule-date"]:checked');
        if (checkboxes.length === 0) {
            alert('콜 가능한 날짜를 선택해주세요.');
            return;
        }
        
        const selectedDates = Array.from(checkboxes).map(cb => cb.value);
        
        // 기존 신청 목록 가져오기
        const existingSchedules = await callAPI('readAll', 'Schedule');
        const myExisting = existingSchedules ? existingSchedules.filter(s => s['전문위원성명'] === loggedInUser.name).map(s => s['신청일자']) : [];
        
        let successCount = 0;
        for (const date of selectedDates) {
            if (myExisting.includes(date)) continue; // 이미 신청한 날짜는 건너뜀
            
            const scheduleData = {
                '전문위원성명': loggedInUser.name,
                '신청일자': date,
                '상태': '신청',
                '처리일시': ''
            };
            const result = await callAPI('write', 'Schedule', { data: scheduleData });
            if (result && result.success) successCount++;
        }
        
        if (successCount > 0) {
            alert(`${successCount}개 일정이 신청되었습니다.`);
            // 전체 스케줄 UI 다시 렌더링 (체크박스 + 신청현황)
            await renderScheduleUI();
        } else {
            alert('이미 신청된 일자이거나 신청에 실패했습니다.');
        }
    }
    window.saveSchedule = saveSchedule;

    // 관리자용 스케줄 관리
    async function renderAdminSchedule() {
        const tbody = document.getElementById('admin-schedule-body');
        const noMsg = document.getElementById('no-schedule-msg');
        
        const schedules = await callAPI('readAll', 'Schedule');
        allSchedules = schedules || [];
        
        if (allSchedules.length === 0) {
            tbody.innerHTML = '';
            noMsg.classList.remove('hidden');
            document.getElementById('admin-schedule-container').classList.add('hidden');
            document.getElementById('schedule-pagination').innerHTML = '';
            return;
        }
        
        noMsg.classList.add('hidden');
        document.getElementById('admin-schedule-container').classList.remove('hidden');
        
        // 검색창 초기화
        const searchInput = document.getElementById('schedule-search');
        if (searchInput) searchInput.value = '';
        
        filterAdminSchedule();
    }
    window.renderAdminSchedule = renderAdminSchedule;
    
    function filterAdminSchedule() {
        scheduleSearchKeyword = document.getElementById('schedule-search')?.value.trim().toLowerCase() || '';
        
        // 검색 필터 적용
        filteredSchedules = allSchedules.filter(s => {
            if (scheduleSearchKeyword && !s['전문위원성명'].toLowerCase().includes(scheduleSearchKeyword)) return false;
            return true;
        });
        
        scheduleCurrentPage = 1;
        renderFilteredSchedules();
    }
    window.filterAdminSchedule = filterAdminSchedule;
    
    function renderFilteredSchedules() {
        const tbody = document.getElementById('admin-schedule-body');
        const noMsg = document.getElementById('no-schedule-msg');
        
        if (filteredSchedules.length === 0) {
            tbody.innerHTML = '';
            noMsg.classList.remove('hidden');
            document.getElementById('schedule-pagination').innerHTML = '';
            return;
        }
        
        noMsg.classList.add('hidden');
        
        // 페이지네이션 계산
        const totalPages = Math.ceil(filteredSchedules.length / schedulePageLimit);
        const start = (scheduleCurrentPage - 1) * schedulePageLimit;
        const end = start + schedulePageLimit;
        const pageSchedules = filteredSchedules.slice(start, end);
        
        tbody.innerHTML = pageSchedules.map((s) => {
            const status = s['상태'] || '신청';
            let statusBadge = '<span class="px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800">⏳ 신청</span>';
            if (status === '확정') {
                statusBadge = '<span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">✅ 확정</span>';
            } else if (status === '취소') {
                statusBadge = '<span class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-800">❌ 취소</span>';
            }
            
            const showButtons = status === '신청';
            
            return `
                <tr class="bg-white border-b">
                    <td class="px-4 py-3 text-center"><input type="checkbox" class="schedule-checkbox" value="${s.originalIndex}"></td>
                    <td class="px-4 py-3 font-semibold">${s['전문위원성명']}</td>
                    <td class="px-4 py-3">${s['신청일자']}</td>
                    <td class="px-4 py-3">${statusBadge}</td>
                    <td class="px-4 py-3 text-sm text-slate-500">${s['처리일시'] || '-'}</td>
                    <td class="px-4 py-3 text-center">
                        ${showButtons ? `
                            <button onclick="updateScheduleStatus(${s.originalIndex}, '확정')" class="px-2 py-1 text-xs font-semibold rounded bg-green-500 text-white hover:bg-green-600 mr-1">확정</button>
                            <button onclick="updateScheduleStatus(${s.originalIndex}, '취소')" class="px-2 py-1 text-xs font-semibold rounded bg-red-500 text-white hover:bg-red-600">취소</button>
                        ` : '<span class="text-xs text-slate-400">처리완료</span>'}
                    </td>
                </tr>
            `;
        }).join('');
        
        // 페이지네이션 렌더링
        renderSchedulePagination(totalPages);
    }
    
    function renderSchedulePagination(totalPages) {
        const container = document.getElementById('schedule-pagination');
        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        let html = '';
        html += `<button onclick="goSchedulePage(${scheduleCurrentPage - 1})" class="px-3 py-1 rounded ${scheduleCurrentPage === 1 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300'}" ${scheduleCurrentPage === 1 ? 'disabled' : ''}>이전</button>`;
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= scheduleCurrentPage - 2 && i <= scheduleCurrentPage + 2)) {
                html += `<button onclick="goSchedulePage(${i})" class="px-3 py-1 rounded ${i === scheduleCurrentPage ? 'bg-slate-800 text-white' : 'bg-slate-200 hover:bg-slate-300'}">${i}</button>`;
            } else if (i === scheduleCurrentPage - 3 || i === scheduleCurrentPage + 3) {
                html += `<span class="px-2">...</span>`;
            }
        }
        
        html += `<button onclick="goSchedulePage(${scheduleCurrentPage + 1})" class="px-3 py-1 rounded ${scheduleCurrentPage === totalPages ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300'}" ${scheduleCurrentPage === totalPages ? 'disabled' : ''}>다음</button>`;
        
        container.innerHTML = html;
    }
    
    function goSchedulePage(page) {
        const totalPages = Math.ceil(filteredSchedules.length / schedulePageLimit);
        if (page < 1 || page > totalPages) return;
        scheduleCurrentPage = page;
        renderFilteredSchedules();
    }
    window.goSchedulePage = goSchedulePage;
    
    function toggleAllSchedules(checkbox) {
        document.querySelectorAll('.schedule-checkbox').forEach(cb => cb.checked = checkbox.checked);
    }
    window.toggleAllSchedules = toggleAllSchedules;
    
    async function deleteSelectedSchedules() {
        const checkboxes = document.querySelectorAll('.schedule-checkbox:checked');
        if (checkboxes.length === 0) {
            alert('삭제할 스케줄을 선택해주세요.');
            return;
        }
        
        if (!confirm(`선택한 ${checkboxes.length}개의 스케줄을 삭제하시겠습니까?`)) return;
        
        // 삭제할 인덱스 수집 (내림차순 정렬 - 아래부터 삭제해야 인덱스 꼬임 방지)
        const indices = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
        
        for (const rowIndex of indices) {
            await callAPI('delete', 'Schedule', { rowIndex });
        }
        
        alert('선택한 스케줄이 삭제되었습니다.');
        document.getElementById('schedule-select-all').checked = false;
        delete apiCache['Schedule'];
        allSchedules = [];
        await renderAdminSchedule();
    }
    window.deleteSelectedSchedules = deleteSelectedSchedules;

    async function updateScheduleStatus(rowIndex, newStatus) {
        // 기존 데이터 가져오기
        const schedules = await callAPI('readAll', 'Schedule');
        const targetSchedule = schedules.find(s => s.originalIndex === rowIndex);
        
        if (!targetSchedule) {
            alert('해당 스케줄을 찾을 수 없습니다.');
            return;
        }
        
        const now = new Date();
        const timestamp = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
        
        // 기존 데이터 유지하면서 상태와 처리일시만 업데이트
        const result = await callAPI('update', 'Schedule', {
            rowIndex: rowIndex,
            data: {
                '전문위원성명': targetSchedule['전문위원성명'],
                '신청일자': targetSchedule['신청일자'],
                '상태': newStatus,
                '처리일시': timestamp
            }
        });
        
        if (result && result.success) {
            alert(`${newStatus} 처리되었습니다.`);
            delete apiCache['Schedule'];
            allSchedules = [];
            await renderAdminSchedule();
        }
    }
    window.updateScheduleStatus = updateScheduleStatus;

    // === 페이지 첫 로드 ===
    document.addEventListener('DOMContentLoaded', () => {
        const savedUser = sessionStorage.getItem('loggedInUser');
        if (savedUser) {
            loggedInUser = JSON.parse(savedUser);
            if (loggedInUser.role === 'admin') {
                showPage('admin-page');
            } else {
                showPage('TM-DB-Table');
            }
        } else {
            showPage('login-page');
        }
    });
</script>
</body>
</html>
